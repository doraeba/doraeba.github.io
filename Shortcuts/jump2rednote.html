{{- $host := "example.com" -}}
{{- $redirect := "/redirect/" -}}

{{- $Content := .Scratch.Get "Content" -}}
{{- $regex := printf `<a href="https://www.icloud.com/shortcuts/5d964848a0684407a5aa83b39d3d8ed5"` $host -}}
{{- $temps := findRE $regex $Content | uniq -}}
{{- with $temps -}}
    {{- range . -}}
        {{- $url := replaceRE $regex `$1` . -}}
        {{- $replacement := printf `<a href="%s?link=%s"` $redirect ($url | base64Encode) -}}
        {{- $Content := replace ($.Scratch.Get "Content") . $replacement | safeHTML -}}
        {{- $.Scratch.Set "Content" $Content -}}
    {{- end -}}
{{- end -}}
